"use strict";angular.module("config",[]).constant("ENV",{name:"production",apiEndpoint:"https://www.rad.co",defaultLang:"fr"}),window.scrollTo(0,1),angular.module("angularApp",["ngAnimate","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","pascalprecht.translate","xml","config","nl2br","infinite-scroll","uiSwitch","payment"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/index.html",controller:"MainCtrl"}).when("/login",{templateUrl:"views/auth/login.html",controller:"LoginCtrl"}).when("/connexion",{templateUrl:"views/auth/connexion.html",controller:"ConnexionCtrl"}).when("/logout",{templateUrl:"views/auth/logout.html",controller:"LogoutCtrl"}).when("/register",{templateUrl:"views/auth/register.html",controller:"RegisterCtrl"}).when("/lost-password",{templateUrl:"views/auth/lost-password.html",controller:"LostPasswordCtrl"}).when("/my-account/orders",{templateUrl:"views/account/my-orders.html",controller:"MyOrdersCtrl"}).when("/my-account/order/:num/:id",{templateUrl:"views/account/order-recap.html",controller:"OrderRecapCtrl"}).when("/category/:categoryslug",{templateUrl:"views/store/category.html",controller:"CategoryCtrl"}).when("/product/:productslug",{templateUrl:"views/store/product.html",controller:"ProductCtrl"}).when("/cart",{templateUrl:"views/store/cart.html",controller:"CartCtrl"}).when("/cart/delivery-address-list",{templateUrl:"views/cart/delivery-address-list.html",controller:"CartDeliveryAddressListCtrl"}).when("/cart/delivery-address-create",{templateUrl:"views/cart/delivery-address-create.html",controller:"CartCreateDeliveryAddressCtrl"}).when("/cart/billing-address-list",{templateUrl:"views/cart/billing-address-list.html",controller:"CartBillingAddressListCtrl"}).when("/cart/billing-address-create",{templateUrl:"views/cart/billing-address-create.html",controller:"CartCreateBillingAddressCtrl"}).when("/cart/payment",{templateUrl:"views/cart/payment-list.html",controller:"CartPaymentListCtrl"}).when("/cart/payment-add",{templateUrl:"views/cart/payment-add.html",controller:"CartPaymentAddCtrl"}).when("/success",{templateUrl:"views/cart/success.html",controller:"SuccessCtrl"}).otherwise({redirectTo:"/"})}]).config(["$httpProvider",function(a){a.interceptors.push("xmlHttpInterceptor")}]).config(["$translateProvider",function(a){var b={TITLE:"Rad.co",APP_NAME:"Rad",global:{loading:"Chargement en cours"},404:{product:"Produit non trouvé",category:"Catégorie non trouvée"},login:{with_facebook:"Se connecter avec Facebook",or_register_email:"Connexion ou inscription par e-mail"},form:{submit:"Valider",use:"Utiliser"},error:{connexion_lost:"Problème de connexion, veuillez re-essayer plus tard.",unknown_reason:"Problème de connexion, veuillez re-essayer plus tard."},connexion:{form:{legend:"Veuillez saisir vos identifiants de connexion.","email.placeholder":"Adresse email","password.placeholder":"Mot de passe"},facebook:"Se connecter avec facebook"},register:{new_account:"Créer un nouveau compte",title:"Inscription",facebook:"S'inscrire avec Facebook",form:{legend:"Merci de renseigner tous les champs suivantes.","firstname.placeholder":"Prénom","lastname.placeholder":"Nom","email.placeholder":"Adresse email","password.placeholder":"Mot de passe","birthday.placeholder":"31/12/2000","cell.placeholder":"06 06 06 06 06"}},lostpass:{title:"Aide","form.legend":"Veuillez renseigner votre adresse e-mail.","form.email.placeholder":"Adresse e-mail.",success:"Un e-mail vient d’être envoyé à {{email}} afin de rénitialiser votre mot de passe."},menu:{search:"Recherche",center_title:"Menu",title:"Menu",cart:"Panier",profile:"Profil",orders:"Mes commandes",payments:"Paiement",addresses:"Mes adresses",free_orders:"Commande offerte",help:"Aide",logout:"Déconnexion",home:"Shop",login:"Connexion"},myaccount:{myorders:{title:"Mes commandes",noorders:"Pas de commandes",order_link:"Commande #{{id}} du {{date}}"},order:{title:"Commande #{{id}}",detail:"Détail de la commande",subTotal:"Sous-total",shipPrice:"Frais de livraison",credit:"Crédit d'achat",total:"Total",payment:"Mode de paiement",delivery:"Livraison",billing:"Facturation"}},product:{product:"Produit",products:"Produits",quantity:"Quantité",size:"Taille",share:"Partager",add:"Ajouter au panier",more_information:"Plus d'infos sur le produit",more_products:"Voir plus de produits {{brand}}",succes_add_cart:"Produit ajouté au panier !"},cart:{product_in_cart:"{{nb}} produit dans votre panier",products_in_cart:"{{nb}} produits dans votre panier",order:"Commander",reloading:"Mise à jour du panier en cours",title:"Panier",valid:"Valider mon panier",empty:"Votre panier est vide",address:{add:"Ajouter une adresse"},delivery:{title:"Adresse de livraison",create_placeholder:"Merci de renseigner votre adresse de livraison.",firstname:"Prénom",lastname:"Nom",address:"Adresse",address2:"Complément d'adresse",city:"Ville",postcode:"Code postal",tel:"Numéro de téléphone",use_for_billing:"Même adresse de facturation"},billing:{title:"Adresse de facturation",create_placeholder:"Merci de renseigner votre adresse de facturation."},payment:{title:"Paiement",add:"Ajouter une carte",add_placeholder:"Merci de renseigner votre information de paiement"}},card:{owner:"Nom sur la carte",number:"Numéro de carte",exp_date:"Date d'expiration",cvc:"Cryptogramme",reusable:"Mémoriser pour mes prochains achats",error:{number:"Numéro de carte erroné",exp:"Date d'expiration erronée",cvc:"Cryptogramme erroné"}},"":""},c=function(a,b,d){return angular.forEach(b,function(b,e){"string"==typeof b?a[d+e]=b:a=c(a,b,d+e+".")}),a};a.translations("fr",c({},b,"")),a.preferredLanguage("fr"),a.useSanitizeValueStrategy(null)}]),angular.module("angularApp").controller("MainCtrl",["$scope","ApiLink","$cookies","$http","LocalStorage","Utils",function(a,b,c,d,e,f){a.inserts=e.getObject("home/inserts"),a.Utils=f,a.inserts||(a.loading=!0,d.get(b.getApiBase()+"/raaad_xmlconnect/index/index/app_code/"+b.getAppCode()+"/level/1").then(function(b){a.loading=!1,b.data&&b.data.home&&b.data.home.inserts&&(a.inserts=b.data.home.inserts.insert,e.putObject("home/inserts",a.inserts))},function(){a.loading=!1}))}]),angular.module("angularApp").controller("LoginCtrl",["$scope",function(a){}]),angular.module("angularApp").controller("ConnexionCtrl",["$scope","User","$location",function(a,b,c){a.title="Connexion",a.email="",a.password="",a.loading=!1,a.error=null,a.submitForm=function(){return a.loading=!0,a.error=null,b.login(a.email,a.password).then(function(d){"success"==d.message.status?c.path(b.getBackPath()):(a.loading=!1,a.error=d.message.text)},function(){a.loading=!1,a.error="error.connexion_lost"}),!1}}]),angular.module("angularApp").controller("RegisterCtrl",["$scope","User","$location",function(a,b,c){a.title="Connexion",a.firstname="",a.lastname="",a.email="",a.password="",a.loading=!1,a.error=null,a.errors=null;var d=function(){return{email:a.email,password:a.password,confirmation:a.password,is_subscribed:!0,firstname:a.firstname,lastname:a.lastname}};a.submitForm=function(){a.loading=!0,a.error=null,a.errors=null,b.register(d()).then(function(d){"success"==d.message.status?c.path(b.getBackPath()):(a.loading=!1,a.errors=d.message.text)},function(){a.loading=!1,a.error="error.connexion_lost"})}}]),angular.module("angularApp").controller("LostPasswordCtrl",["$scope","User","$timeout","$location",function(a,b,c,d){a.title="lostpass.title",a.email="",a.loading=!1,a.error=null,a["false"]=!0,a.submitForm=function(){a.loading=!0,a.error=null,b.forgotPassword(a.email).then(function(e){a.loading=!1,"success"==e.message.status?(a.success="lostpass.success",a.error=null,a.translateData={email:a.email},c(function(){d.path(b.getBackPath())},5e3)):a.error=e.message.text},function(){a.loading=!1,a.error="error.connexion_lost"})}}]),angular.module("angularApp").controller("LogoutCtrl",["$scope","$location","User","$timeout","LocalStorage","$cookies","$cookieStore",function(a,b,c,d,e,f,g){c.logout(),e.clear(),angular.forEach(f,function(a,b){g.remove(b)}),d(function(){b.path("/")},2e3)}]),angular.module("angularApp").controller("CategoryCtrl",["$scope","$routeParams","$location","Category","Utils","$timeout",function(a,b,c,d,e,f){return a.categoryId=parseInt(b.categoryslug),a.page=0,a.title="global.loading",a.loaded=!1,a.infiniteLoading=!1,a.infiniteDisabled=!0,isNaN(a.categoryId)?c.path("/"):(isNaN(a.page)&&(a.page=0),a.loading=!0,a.category=null,d.get(a.categoryId,a.page).then(function(b){return a.loading=!1,b.products?(a.category=b,void f(function(){a.infiniteDisabled=!1})):a.error=!0},function(){a.error=!0,a.loading=!1}),a.loadMore=function(){a.infiniteLoading||a.infiniteDisabled||(a.infiniteLoading=!0,d.get(a.categoryId,++a.page).then(function(b){return a.infiniteLoading=!1,b.products?void angular.forEach(b.products.item,function(b){a.category.products.item.push(b)}):a.infiniteDisabled=!0},function(){a.infiniteLoading=!1}))},void(a.goToProduct=function(a){c.path("/product/"+a.entity_id+"-"+e.slugify(a.name))}))}]),angular.module("angularApp").controller("ProductCtrl",["$scope","$routeParams","$location","Product","Cart","$timeout",function(a,b,c,d,e,f){a.productId=parseInt(b.productslug),a.title="global.loading",a.loading=!0,a.error=!1,a.product=null,a.images=[],a.options=[],a.quantity=1,d.get(a.productId).then(function(b){a.loading=!1,a.product=b,a.images=["http://geoffrey.pro/img2.png","http://geoffrey.pro/img1.png"],f(function(){a.title=b.name+""}),a.options=Array.isArray(b.product.options.option)?b.product.options.option:[b.product.options.option],b.product.options.option||(a.options=[])},function(){a.error=!0,a.loading=!1}),a.changeOption=function(a,b){angular.forEach(a,function(a){a.active=b._code==a._code})},a.addError=null,a.addToCart=function(){a.success=null,a.addError=null,a.loading=!0,e.addProduct(a.productId,a.quantity,g()).then(function(b){a.loading=!1,a.error=!1,a.success=b,f(function(){a.success=null},5e3)},function(b){a.addError=b||"error.connexion_lost",a.loading=!1})};var g=function(){var b={};return angular.forEach(a.options,function(a){angular.forEach(a.value,function(c){c.active&&(b[a._code]=c._code)})}),b};a.addQty=function(){a.quantity=a.quantity+(a.quantity<40)},a.delQty=function(){a.quantity=a.quantity-(a.quantity>1)}}]),angular.module("angularApp").controller("MyOrdersCtrl",["$scope","User","$location","order",function(a,b,c,d){return b.isLoggued()?(a.loading=!0,a.orders=[],a.error=!1,a.no_orders=!1,a.title="myaccount.myorders.title",void d.list().then(function(b){return a.no_orders=!1,a.loading=!1,b.message&&"error"===b.message.status?a.error=b.message.text:b.orders&&b.orders.item?a.orders=b.orders.item:void(a.no_orders=!0)},function(){a.loading=!1,a.error="error.connexion_lost"})):c.path("/login")}]),angular.module("angularApp").controller("OrderRecapCtrl",["$scope","$routeParams","User","$location","order",function(a,b,c,d,e){return c.isLoggued()?(a.loading=!0,a.order=null,a.error=!1,a.title="myaccount.order.title",a.transData={id:b.num},a.items=[],a.totals=[],e.get(b.num).then(function(b){return a.loading=!1,b.message&&"error"===b.message.status?a.error=b.message.text:b.order_details?(a.order=b.order_details,a.items=Array.isArray(a.order.ordered_items.item)?a.order.ordered_items.item:[a.order.ordered_items.item],a.totals=[],void angular.forEach(a.order.totals,function(b){b.summary&&(b=b.summary),a.totals.push({label:b._label,val:b.__text})})):void(a.error="error.connexion_lost")},function(){a.loading=!1,a.error="error.connexion_lost"}),void(a.sameAddresses=function(a,b){return a.entity_id.__text==b.entity_id.__text?!0:a.city.__text==b.city.__text&&a.country.__text==b.country.__text&&a.country_id.__text==b.country_id.__text&&a.firstname.__text==b.firstname.__text&&a.lastname.__text==b.lastname.__text&&a.postcode.__text==b.postcode.__text&&a.street1.__text==b.street1.__text&&a.street.__text==b.street.__text&&a.telephone.__text==b.telephone.__text})):d.path("/login")}]),angular.module("angularApp").service("CurrentUser",function(){return{}}),angular.module("angularApp").service("responseHandler",["$q",function(a){var b=function(b,c){return"object"==typeof b.data?("function"==typeof c&&c(b),b.data):a.reject(b.data)},c=function(b){a.reject(b.data)},d=function(a){return a.then(b,c)};return{success:b,error:c,handle:d}}]),angular.module("angularApp").service("Utils",function(){var a=function(a){return a?a.toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""):""},b=function(a){if(null==a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(hasOwnProperty.call(a,b))return!1;return!0},c=function(){return 0|Math.floor(Date.now()/1e3)},d=function(a){return Array.isArray(a)?a:[a]};return{slugify:a,isEmpty:b,getTimestamp:c,arrayfy:d}}),angular.module("angularApp").service("ApiLink",["ENV","Lang",function(a,b){var c=function(a,b,c){var d="";c&&angular.forEach(c,function(a,b){d+="/"+encodeURIComponent(b)+"/"+encodeURIComponent(a)});var h=encodeURIComponent(a)+"/"+encodeURIComponent(b),i=e(h)?"raaad_xmlconnect":"xmlconnect";return f()+"/"+i+"/"+h+"/app_code/"+g()+d},d=function(){return["customer/token","customer/orderdetails","cart/index","cart/add","cart/delete","cart/update","checkout/address","stripe/savedcards"]},e=function(a){return-1!=d().indexOf(a)},f=function(){return a.apiEndpoint+"/"+b.get()},g=function(){return encodeURIComponent(b.getAppCode())};return{get:c,getApiBase:f,getAppCode:g}}]),angular.module("angularApp").service("Lang",["ENV","$cookies",function(a,b){var c="fr us uk de".split(" "),d=b.get("lang")||a.defaultLang,e=function(){return d},f=function(a){a=a.toLowerCase();for(var b=0;b<c.length;b++)if(c[b]===a.toLowerCase()){d=a;break}return d};return{get:e,set:f,getAppCode:function(){return"fr_iph1"}}}]),angular.module("angularApp").service("MagentoPostRequest",["$http","$httpParamSerializer",function(a,b){return function(c,d,e){var f={"Content-Type":"application/x-www-form-urlencoded"};return e&&(f.Authorization='token="'+e+'"'),a({method:"POST",url:c,headers:f,data:b(d)})}}]),angular.module("angularApp").factory("User",["$http","ApiLink","MagentoPostRequest","$cookies","responseHandler","$q","LocalStorage","$location",function(a,b,c,d,e,f,g,h){var i,j,k="_token_user",l=function(a){a&&g.put("login/backpath",a,86400),h.path("/login")},m=function(){var a=g.get("login/backpath");return a?(g.remove("login/backpath"),a):"/"},n=function(b){i=b,b?(o(0),d.put(k,b),a.defaults.headers.common.Authorization='token="'+b+'"'):(d.remove(k),d.remove(k+"_anonymous"),delete a.defaults.headers.common.Authorization)},o=function(a){j=!!a,d.remove(k+"_anonymous"),d.put(k+"_anonymous",a)},p=function(){return!j},q=function(a){return e.success(a,function(a){a.data.message.token&&n(a.data.message.token)})},r=function(a,d){return c(b.get("customer","login"),{username:a,password:d},i).then(q,e.error)},s=function(a){return c(b.get("customer","save"),a,i).then(q,e.error)},t=function(c){return c?f(function(c,d){return i?c(i+""):a.get(b.get("customer","token")).then(function(a){return a.data.message?(n(a.data.message.token),o(1),c(a.data.message.token)):void d(null)},function(){return d(null)})}):(i||"")+""},u=function(a){return c(b.get("customer","forgotpassword"),{email:a},i).then(q,e.error)},v=function(){return a({method:"GET",url:b.get("customer","logout"),headers:{Authorization:'token="'+i+'"'}}).then(function(){n(null),o(1)})};n(d.get(k)||null);var w=parseInt(d.get(k+"_anonymous"));return o(isNaN(w)?1:w),{login:r,logout:v,register:s,forgotPassword:u,getToken:t,isLoggued:p,goToLogin:l,getBackPath:m}}]),angular.module("angularApp").factory("order",["User","$http","responseHandler","ApiLink",function(a,b,c,d){var e=function(){return c.handle(b({method:"GET",url:d.get("customer","orderlist")}))},f=function(a){return c.handle(b({method:"GET",url:d.get("customer","orderdetails",{increment_id:a})}))};return{list:e,get:f}}]),angular.module("angularApp").factory("Product",["$http","responseHandler","ApiLink","LocalStorage","$q",function(a,b,c,d,e){var f=function(f){return e(function(e,g){var h="catalog/product/"+f,i=d.getObject(h);return i?e(i):void b.handle(a({method:"GET",url:c.get("catalog","product",{id:f})})).then(function(a){return a.product&&a.product.name?(d.putObject(h,a.product,300),e(a.product)):void g(null)},function(){g(null)})})};return{get:f}}]),angular.module("angularApp").factory("MenuCategories",["$http","$q","$cookies","ApiLink",function(a,b,c,d){var e="MenuCategories",f=3600,g=null,h=function(){return 0|Math.floor(Date.now()/1e3)},i=function(){var a=c.getObject(e+"_val");if(a){var b=parseInt(c.get(e+"_time"));if(!(b<h()))return g=a,a;c.remove(e+"_val")}return null},j=function(a){var b={};return angular.forEach(a.category,function(a){b[a.entity_id]={n:a.name,c:{}},a.children&&angular.forEach(a.children.category,function(c){b[a.entity_id].c[c.entity_id]=c.name})}),b},k=function(a){return a=j(a),g=a,c.putObject(e+"_val",a),c.put(e+"_time",h()+f),a},l=function(){return b(function(b,c){var e=g||i();return e?b(e):void a.get(d.getApiBase()+"/raaad_xmlconnect/index/index/app_code/"+d.getAppCode()+"/level/3").then(function(a){a.data&&a.data.home&&a.data.home.categorytree?(e=a.data.home.categorytree,b(k(e))):c(null)},function(){c(null)})})};return function(){return l()}}]),angular.module("angularApp").factory("Category",["$http","responseHandler","ApiLink","LocalStorage","$q",function(a,b,c,d,e){var f=function(f,g){return e(function(e,h){var i="catalog/category/"+f+"-"+g,j=d.getObject(i);if(j)return e(j);var k,l;1>=g?(k=6,l=0):(k=20,l=20*(g-1)+6),b.handle(a({method:"GET",url:c.get("catalog","category",{id:f,count:k,offset:l})})).then(function(a){return a.category?(d.putObject(i,a.category,300),e(a.category)):void h(null)},function(){h(null)})})};return{get:f}}]),angular.module("angularApp").directive("splashScreen",function(){return{restrict:"A",link:function(a,b){angular.element(document).ready(function(){b.remove()})}}}),angular.module("angularApp").directive("loader",function(){return{template:'<div class="loader-directive"><div class="loader"></div></div>'}}),angular.module("angularApp").directive("cartFooter",["Cart",function(a){return{templateUrl:"views/directives/cart-footer.html",restrict:"E",link:function(b){var c=angular.element("body");b.nb_product=a.getNbProduct(!0);var d=function(){b.nb_product=a.getNbProduct(!0),b.nb_product?c.addClass("has-cart-footer"):c.removeClass("has-cart-footer")};a.notifyUpdate(d)}}}]),angular.module("angularApp").directive("menuTop",["$http","MenuCategories","Utils",function(a,b,c){return{templateUrl:"views/directives/menutop.html",restrict:"E",scope:{disabledCartFooter:"@",menuTitle:"=?"},link:function(a){a.Utils=c,a.categories=null,a.disabledCartFooter=1==a.disabledCartFooter;var d=null;a.toggleMenuState=function(){d=d||angular.element("#menu-dropdown"),d.toggleClass("menu-open")},b().then(function(b){a.categories=b})}}}]),angular.module("angularApp").directive("menuLeftBtn",["User","$rootScope","Cart",function(a,b,c){var d=angular.element("html");return b.$on("$routeChangeStart",function(){d.removeClass("left-open")}),{templateUrl:"views/directives/menuleftbtn.html",restrict:"E",link:function(b,e){b.nbProduct=null,b.User=a,e.find(".left-menu-opener").click(function(a){a.preventDefault(),null===b.nbProduct&&c.getNbProduct().then(function(a){b.nbProduct=a}),d.toggleClass("left-open")}),angular.element("[data-close-menu-left] a").click(function(){d.toggleClass("left-open")})}}}]),angular.module("angularApp").service("LocalStorage",["Utils",function(a){var b=window.localStorage,c=600,d=function(c){var d=parseInt(b.getItem(c+"_time"));return d<a.getTimestamp()?(i(c),null):b.getItem(c)},e=function(d,e,f){f=f||c,b.setItem(d+"_time",a.getTimestamp()+f),b.setItem(d,e)},f=function(a){var b=d(a);if(b)try{return JSON.parse(b)}catch(c){b=null}return b},g=function(a,b,d){d=d||c,e(a,JSON.stringify(b),d)},h=function(){b.clear()},i=function(a){b.removeItem(a+"_time"),b.removeItem(a)};return{get:d,put:e,getObject:f,putObject:g,clear:h,remove:i}}]),angular.module("angularApp").factory("Cart",["User","$q","ApiLink","$http","MagentoPostRequest","LocalStorage","Utils",function(a,b,c,d,e,f,g){var h=f.getObject("checkout/orderreview"),i=[],j=function(a){return h=a,f.putObject("checkout/orderreview",a),k(),h},k=function(){angular.forEach(i,function(a){a()})},l=function(a){i.push(a)},m=function(){return null!==h},n=function(a){return b(function(b,c){return a===!0||null===h?p().then(function(){b(h)},function(a){c(a)}):b(h)})},o=function(){var a={groups:[],items:[],totals:h.totals,empty:!h.products};return a.empty||angular.forEach(g.arrayfy(h.products.group),function(b){var c=[];angular.forEach(g.arrayfy(b.items.item),function(b){b.options.option=g.arrayfy(b.options.option),c.push(b),a.items.push(b)}),a.groups.push(c)}),a},p=function(){return b(function(b,e){a.getToken(!0).then(function(){return d({url:c.get("checkout","orderreview"),method:"GET",headers:{Authorization:'token="'+a.getToken()+'"'}}).then(function(a){return a.data.order&&a.data.order?(j(a.data.order),b(a.data.order)):e(null)},function(){return e(null)})},function(){return e(null)})})},q=function(d,f,g){return b(function(b,h){a.getToken(!0).then(function(){var i=angular.copy(g);i.product=d,i.qty=f,e(c.get("cart","add"),i,a.getToken()).then(function(a){return a.data.order&&a.data.order.message&&a.data.order.message.text?"success"!=a.data.order.message.status?h(a.data.order.message.text):(j(a.data.order),b(a.data.order.message.text)):h(a.data.message?a.data.message.text:null)},function(){return h(null)})})})},r=function(a){var c=function(){var a=0,b=o();return b.empty?0:(angular.forEach(g.arrayfy(b.items),function(b){a+=parseInt(b.qty)}),a)};return m()&&a?c():a?null:b(function(a,b){n().then(function(){return a(c())},function(){b(null)})})},s=function(){f.putObject(h,{},0)},t=function(d){return b(function(b,f){return e(c.get("checkout","saveorder"),d,a.getToken()).then(function(a){return a.data.message&&a.data.message.status&&"success"==a.data.message.status?(s(),b(a.data.message.order_id)):f(a.data.message.text)},function(){f("error.connexion_lost")})})};return{init:p,reload:p,addProduct:q,getNbProduct:r,getDetails:n,isInit:m,notifyUpdate:l,getFormattedDetails:o,pay:t,clear:s}}]),angular.module("angularApp").controller("CartCtrl",["$scope","Cart","User",function(a,b,c){if(console.log(c.isLoggued()),!c.isLoggued())return c.goToLogin("/cart");a.title="cart.title",a.loading=!0,a.error=!1;var d=function(c){c.then(function(){a.details=b.getFormattedDetails()})};d(b.getDetails()),b.getDetails(!0).then(function(){a.loading=!1,a.error=null,d(b.getDetails())},function(){a.loading=!1,a.error="error.connexion_lost"})}]),angular.module("angularApp").controller("CartDeliveryAddressListCtrl",["$scope","User","Address","$location",function(a,b,c,d){return b.isLoggued()?(a.title="cart.delivery.title",a.masterLoading=!1,a.loading=!0,a.addresses=[],c.getAddresses(!0).then(function(b){a.loading=!1,a.addresses=b},function(b){a.loading=!1,a.error=b}),void(a.useAddress=function(b){return a.masterLoading=!0,a.error=null,c.add({"shipping[use_for_billing]":0,shipping_address_id:b.entity_id}).then(function(b){return b.data.message&&"success"==b.data.message.status?d.path("/cart/billing-address-list"):(a.masterLoading=!1,void(a.error=b.data.message.text||"error.unknown_reason"))},function(){a.masterLoading=!1,a.error="error.connexion_lost"}),!1})):b.goToLogin("/cart")}]),angular.module("angularApp").factory("Address",["$http","$q","ApiLink","LocalStorage","User","MagentoPostRequest","Utils",function(a,b,c,d,e,f,g){var h="checkout/address",i=function(f){return b(function(b,i){var j=d.getObject(h);return j&&f!==!0?b(j):void a({method:"GET",url:c.get("checkout","address"),headers:{Authorization:'token="'+e.getToken()+'"'}}).then(function(a){return a.data.message?i(a.data.message.text):a.data.addresses?(j=[],a.data.addresses.item&&(j=g.arrayfy(a.data.addresses.item)),d.putObject(h,j,600),b(j)):i("error.connexion_lost")},function(){return i("error.connexion_lost")})})},j=function(a,b){return f(c.get("checkout","saveshippingaddress"),a,e.getToken())};return{getAddresses:i,add:j}}]),angular.module("angularApp").controller("CartCreateDeliveryAddressCtrl",["$scope","Address","User","$location","ENV","Lang",function(a,b,c,d,e,f){c.isLoggued()||c.goToLogin("/cart/delivery-address-create"),a.title="cart.delivery.title",a.loading=!1,a.use_for_billing=!0,a.firstname="",a.lastname="",a.street="",a.street1="",a.city="",a.postcode="",a.telephone="","development"==e.name&&(a.use_for_billing=!1,a.firstname="Geoffrey",a.lastname="Hervet",a.street="5 avenue Édouard Vaillant",a.street1="Code 34A76",a.city="Pantin",a.postcode="93500",a.telephone="06 29 50 19 89"),a.submitForm=function(){return a.loading=!0,a.error=null,b.add({"shipping[use_for_billing]":a.use_for_billing?1:0,"shipping[firstname]":a.firstname,"shipping[lastname]":a.lastname,"shipping[street][0]":a.street,"shipping[street][1]":a.street1,"shipping[city]":a.city,"shipping[postcode]":a.postcode,"shipping[telephone]":a.telephone,"shipping[save_in_address_book]":1,"shipping[country_id]":f.get()}).then(function(b){return b.data.message&&"success"==b.data.message.status?a.use_for_billing?d.path("/cart/payment"):d.path("/cart/billing-address-list"):(a.loading=!1,void(a.error=b.data.message.text||"error.unknown_reason"))},function(){a.error="error.connexion_lost"}),!1}}]),angular.module("angularApp").controller("CartCreateBillingAddressCtrl",["$scope","Address","User","$location","ENV",function(a,b,c,d,e){c.isLoggued()||c.goToLogin("/cart"),a.title="cart.billing.title",a.loading=!1,a.use_for_billing=!0,a.firstname="",a.lastname="",a.street="",a.street1="",a.city="",a.postcode="",a.telephone="","development"==e.name&&(a.use_for_billing=!1,a.firstname="Jean",a.lastname="Michel",a.street="35 rue des Jeuneurs",a.street1="pas de digicode",a.city="Paris",a.postcode="75002",a.telephone="01 23 45 67 89"),a.submitForm=function(){return a.loading=!0,a.error=null,b.add({"billing[firstname]":a.firstname,"billing[lastname]":a.lastname,"billing[street][0]":a.street,"billing[street][1]":a.street1,"billing[city]":a.city,"billing[postcode]":a.postcode,"billing[telephone]":a.telephone,"billing[save_in_address_book]":1}).then(function(b){return b.data.message&&"success"==b.data.message.status?d.path("/cart/payment"):(a.loading=!1,void(a.error=b.data.message.text||"error.unknown_reason"))},function(){a.error="error.connexion_lost"}),!1}}]),angular.module("angularApp").controller("CartBillingAddressListCtrl",["$scope","User","Address","$location",function(a,b,c,d){return b.isLoggued()?(a.title="cart.billing.title",a.masterLoading=!1,a.loading=!0,a.addresses=[],c.getAddresses().then(function(b){a.loading=!1,a.addresses=b},function(b){a.loading=!1,a.error=b}),void(a.useAddress=function(b){return a.masterLoading=!0,a.error=null,c.add({billing_address_id:b.entity_id}).then(function(b){return b.data.message&&"success"==b.data.message.status?d.path("/cart/payment"):(a.masterLoading=!1,void(a.error=b.data.message.text||"error.unknown_reason"))},function(){a.masterLoading=!1,a.error="error.connexion_lost"}),!1})):b.goToLogin("/cart")}]),angular.module("angularApp").controller("CartPaymentListCtrl",["$scope","User","Cart","SavedCards","$location","LocalStorage",function(a,b,c,d,e,f){return b.isLoggued()?(a.title="cart.payment.title",a.masterLoading=!1,a.loading=!0,a.payments=[],d.get().then(function(b){a.loading=!1,a.payments=b},function(b){a.loading=!1,a.error=b}),a.usePayment=function(b){a.masterLoading=!0,c.pay({"payment[method]":"cryozonic_stripe","payment[cc_saved]":b.id}).then(function(a){return c.clear(),f.put("order_id",a),e.path("/success")},function(b){a.masterLoading=!1,a.error=b})},void(a.format=function(a){return a.type+" "+a.number.slice(-4)})):b.goToLogin("/cart")}]),angular.module("angularApp").factory("SavedCards",["User","$q","$http","ApiLink","Utils",function(a,b,c,d,e){var f=function(){return b(function(b,f){c({method:"GET",url:d.get("stripe","savedcards"),headers:{Authorization:'token="'+a.getToken()+'"'}}).then(function(a){return b(a.data.savedcards&&a.data.savedcards.savedcard?e.arrayfy(a.data.savedcards.savedcard):[])},function(){f("error.connexion_lost")})})};return{get:f}}]),angular.module("angularApp").controller("CartPaymentAddCtrl",["$scope","User","Cart","LocalStorage",function(a,b,c,d){if(!b.isLoggued())return b.goToLogin("/cart");a.title="cart.payment.title",a.loading=!1,a.save_my_card=!0,window.logVals=function(){console.log("owner",a.owner),console.log("cardNumber",a.cardNumber),console.log("cardType",a.cardType),console.log("cardExpiry",a.cardExpiry),console.log("cardCvc",a.cardCvc),console.log("save_my_card",a.save_my_card)};var e=function(){return a.error=null,a.cardNumber?a.cardExpiry?a.cardCvc?!0:(a.error="card.error.cvc",!1):(a.error="card.error.exp",!1):(a.error="card.error.number",!1)};a.submitForm=function(){return e()?(a.loading=!0,void c.pay({"payment[method]":"cryozonic_stripe","payment[cc_owner]":a.owner,"payment[cc_number]":a.cardNumber,"payment[cc_exp_month]":a.cardExpiry.month,"payment[cc_exp_year]":a.cardExpiry.year,"payment[cc_cid]":a.cardCvc,"payment[cc_save]":a.save_my_card?"on":"new_card"}).then(function(a){return d.put("order_id",a),$location.path("/success")},function(b){a.loading=!1,a.error=b})):!1}}]),angular.module("angularApp").controller("SuccessCtrl",["$scope","LocalStorage",function(a,b){a.title="cart.success",a.order=b.get("order_id")}]),angular.module("angularApp").directive("searchBtn",["$location",function(a){return{templateUrl:"views/directives/search-btn.html",restrict:"E",link:function(b,c,d){b.searchValue="";var e=angular.element(".right-menu-opener"),f=angular.element(e.attr("href"));e.click(function(a){return f.show(),f.find("input").focus(),a.preventDefault(),!1}),f.find(".close-btn").click(function(a){return a.preventDefault(),f.hide(),!1}),b.goToSearch=function(){return a.path("/search").search({q:b.searchValue}),!1}}}}]);